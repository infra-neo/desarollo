{
  "version": "1.0",
  "metadata": {
    "name": "MCP Server Infrastructure - Desarollo",
    "author": "Ing. Benjam\u00edn Fr\u00edas \u2014 DevOps & Cloud Specialist",
    "description": "Complete MCP Server infrastructure with Banking Automation",
    "created": "2025-11-16T01:59:43.333989",
    "provider": "gcp",
    "region": "us-central1"
  },
  "architecture": {
    "components": [
      {
        "id": "comp_1",
        "name": "desarollo-vpc",
        "type": "gcp.network.vpc",
        "properties": {
          "cidr": "10.0.0.0/16",
          "region": "us-central1"
        },
        "subnet": null,
        "position": {
          "x": 100,
          "y": 100
        }
      },
      {
        "id": "comp_2",
        "name": "public-subnet",
        "type": "gcp.network.subnet",
        "properties": {
          "cidr": "10.0.1.0/24",
          "zone": "us-central1-a"
        },
        "subnet": null,
        "position": {
          "x": 300,
          "y": 100
        }
      },
      {
        "id": "comp_3",
        "name": "private-subnet",
        "type": "gcp.network.subnet",
        "properties": {
          "cidr": "10.0.2.0/24",
          "zone": "us-central1-a"
        },
        "subnet": null,
        "position": {
          "x": 500,
          "y": 100
        }
      },
      {
        "id": "comp_4",
        "name": "database-subnet",
        "type": "gcp.network.subnet",
        "properties": {
          "cidr": "10.0.3.0/24",
          "zone": "us-central1-a"
        },
        "subnet": null,
        "position": {
          "x": 700,
          "y": 100
        }
      },
      {
        "id": "comp_5",
        "name": "PostgreSQL Master",
        "type": "gcp.sql.database",
        "properties": {
          "version": "POSTGRES_15",
          "tier": "db-g1-small",
          "databases": [
            "authentik",
            "jumpserver",
            "infisical",
            "onepanel",
            "webasset"
          ]
        },
        "subnet": "database-subnet",
        "position": {
          "x": 100,
          "y": 250
        }
      },
      {
        "id": "comp_6",
        "name": "Traefik Reverse Proxy",
        "type": "docker.service",
        "properties": {
          "image": "traefik:v2.10",
          "ports": [
            "80",
            "443"
          ],
          "features": [
            "SSL Termination",
            "Load Balancing",
            "Auto-Discovery",
            "Let's Encrypt"
          ]
        },
        "subnet": "public-subnet",
        "position": {
          "x": 300,
          "y": 250
        }
      },
      {
        "id": "comp_7",
        "name": "Authentik IdP",
        "type": "docker.service",
        "properties": {
          "image": "goauthentik/server:2024.2.2",
          "replicas": 2,
          "features": [
            "OIDC Provider",
            "SAML Provider",
            "LDAP Provider",
            "ForwardAuth"
          ]
        },
        "subnet": "private-subnet",
        "position": {
          "x": 500,
          "y": 250
        }
      },
      {
        "id": "comp_8",
        "name": "Redis Cache",
        "type": "docker.service",
        "properties": {
          "image": "redis:7-alpine",
          "persistence": true
        },
        "subnet": "private-subnet",
        "position": {
          "x": 700,
          "y": 250
        }
      },
      {
        "id": "comp_9",
        "name": "Infisical Secrets",
        "type": "docker.service",
        "properties": {
          "image": "infisical/infisical:latest",
          "replicas": 2,
          "features": [
            "Secret Management",
            "Key Rotation",
            "Audit Logs"
          ]
        },
        "subnet": "private-subnet",
        "position": {
          "x": 100,
          "y": 400
        }
      },
      {
        "id": "comp_10",
        "name": "JumpServer Audit",
        "type": "docker.service",
        "properties": {
          "image": "jumpserver/jms_all:v3.10.3",
          "replicas": 2,
          "features": [
            "Session Recording",
            "Audit Trail",
            "Asset Management",
            "OIDC Integration"
          ]
        },
        "subnet": "private-subnet",
        "position": {
          "x": 300,
          "y": 400
        }
      },
      {
        "id": "comp_11",
        "name": "1Panel Admin",
        "type": "docker.service",
        "properties": {
          "image": "moelin/1panel:latest",
          "features": [
            "Server Management",
            "Docker Management",
            "File Manager"
          ]
        },
        "subnet": "private-subnet",
        "position": {
          "x": 500,
          "y": 400
        }
      },
      {
        "id": "comp_12",
        "name": "WebAsset Controller",
        "type": "docker.service",
        "properties": {
          "image": "webasset-controller:latest",
          "replicas": 3,
          "features": [
            "Browser Automation",
            "BMG Integration",
            "iCred Integration",
            "Session Recording",
            "OIDC Authentication"
          ]
        },
        "subnet": "private-subnet",
        "position": {
          "x": 700,
          "y": 400
        }
      },
      {
        "id": "comp_13",
        "name": "BMG Consig",
        "type": "external.service",
        "properties": {
          "url": "https://www.bmgconsig.com.br",
          "type": "Banking Platform"
        },
        "subnet": null,
        "position": {
          "x": 100,
          "y": 550
        }
      },
      {
        "id": "comp_14",
        "name": "iCred API",
        "type": "external.service",
        "properties": {
          "url": "https://api.icred.app",
          "type": "Banking API"
        },
        "subnet": null,
        "position": {
          "x": 300,
          "y": 550
        }
      },
      {
        "id": "comp_15",
        "name": "Tailscale VPN",
        "type": "service.vpn",
        "properties": {
          "features": [
            "Zero Trust Network",
            "MagicDNS",
            "ACL-based Access"
          ]
        },
        "subnet": "public-subnet",
        "position": {
          "x": 500,
          "y": 550
        }
      },
      {
        "id": "comp_16",
        "name": "End Users (50 concurrent)",
        "type": "user.group",
        "properties": {
          "count": 50,
          "authentication": "SSO via Authentik"
        },
        "subnet": null,
        "position": {
          "x": 700,
          "y": 550
        }
      }
    ],
    "connections": [
      {
        "source": "comp_16",
        "target": "comp_6",
        "type": "https",
        "bidirectional": false
      },
      {
        "source": "comp_6",
        "target": "comp_7",
        "type": "http",
        "bidirectional": false
      },
      {
        "source": "comp_6",
        "target": "comp_9",
        "type": "http",
        "bidirectional": false
      },
      {
        "source": "comp_6",
        "target": "comp_10",
        "type": "http",
        "bidirectional": false
      },
      {
        "source": "comp_6",
        "target": "comp_11",
        "type": "http",
        "bidirectional": false
      },
      {
        "source": "comp_6",
        "target": "comp_12",
        "type": "http",
        "bidirectional": false
      },
      {
        "source": "comp_7",
        "target": "comp_8",
        "type": "redis",
        "bidirectional": false
      },
      {
        "source": "comp_9",
        "target": "comp_8",
        "type": "redis",
        "bidirectional": false
      },
      {
        "source": "comp_10",
        "target": "comp_8",
        "type": "redis",
        "bidirectional": false
      },
      {
        "source": "comp_7",
        "target": "comp_5",
        "type": "postgresql",
        "bidirectional": false
      },
      {
        "source": "comp_10",
        "target": "comp_5",
        "type": "postgresql",
        "bidirectional": false
      },
      {
        "source": "comp_9",
        "target": "comp_5",
        "type": "postgresql",
        "bidirectional": false
      },
      {
        "source": "comp_11",
        "target": "comp_5",
        "type": "postgresql",
        "bidirectional": false
      },
      {
        "source": "comp_12",
        "target": "comp_5",
        "type": "postgresql",
        "bidirectional": false
      },
      {
        "source": "comp_12",
        "target": "comp_9",
        "type": "api",
        "bidirectional": false
      },
      {
        "source": "comp_12",
        "target": "comp_10",
        "type": "api",
        "bidirectional": false
      },
      {
        "source": "comp_12",
        "target": "comp_13",
        "type": "https",
        "bidirectional": false
      },
      {
        "source": "comp_12",
        "target": "comp_14",
        "type": "https",
        "bidirectional": false
      },
      {
        "source": "comp_15",
        "target": "comp_6",
        "type": "vpn",
        "bidirectional": false
      },
      {
        "source": "comp_15",
        "target": "comp_11",
        "type": "vpn",
        "bidirectional": false
      }
    ],
    "subnets": [
      {
        "name": "Public Subnet",
        "cidr": "10.0.1.0/24",
        "zone": "us-central1-a",
        "components": [
          "comp_6",
          "comp_15"
        ]
      },
      {
        "name": "Private Subnet",
        "cidr": "10.0.2.0/24",
        "zone": "us-central1-a",
        "components": [
          "comp_7",
          "comp_8",
          "comp_9",
          "comp_10",
          "comp_11",
          "comp_12"
        ]
      },
      {
        "name": "Database Subnet",
        "cidr": "10.0.3.0/24",
        "zone": "us-central1-a",
        "components": [
          "comp_5"
        ]
      }
    ]
  },
  "security": {
    "firewall_rules": [
      {
        "name": "allow-https-ingress",
        "direction": "ingress",
        "protocol": "tcp",
        "port": "443",
        "source": "0.0.0.0/0",
        "target": "public-subnet"
      },
      {
        "name": "deny-all-database",
        "direction": "ingress",
        "protocol": "all",
        "port": "all",
        "source": "0.0.0.0/0",
        "target": "database-subnet",
        "action": "deny"
      }
    ],
    "encryption": {
      "in_transit": "TLS 1.3",
      "at_rest": "AES-256"
    },
    "authentication": {
      "method": "OIDC",
      "provider": "Authentik",
      "mfa": "enabled"
    }
  },
  "terraform": {
    "modules": [
      "modules/compute",
      "modules/network",
      "modules/firewall",
      "modules/postgresql",
      "modules/authentik",
      "modules/tailscale",
      "modules/traefik",
      "modules/jumpserver",
      "modules/infisical",
      "modules/onepanel",
      "modules/webasset-controller"
    ],
    "state_backend": "gcs",
    "state_bucket": "desarollo-terraform-state"
  }
}